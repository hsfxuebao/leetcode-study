# å°è€Œç¾çš„ç®—æ³•æŠ€å·§ï¼šå‰ç¼€å’Œæ•°ç»„
è¯»å®Œæœ¬æ–‡ï¼Œä½ ä¸ä»…å­¦ä¼šäº†ç®—æ³•å¥—è·¯ï¼Œè¿˜å¯ä»¥é¡ºä¾¿è§£å†³å¦‚ä¸‹é¢˜ç›®ï¼š

LeetCode	åŠ›æ‰£	éš¾åº¦
303. Range Sum Query - Immutable	303. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜	ğŸŸ¢
304. Range Sum Query 2D - Immutable	304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜	ğŸŸ 
-	å‰‘æŒ‡ Offer II 013. äºŒç»´å­çŸ©é˜µçš„å’Œ	ğŸŸ 
â€”â€”â€”â€“

æœ¬æ–‡æœ‰è§†é¢‘ç‰ˆï¼š å‰ç¼€å’Œ/å·®åˆ†æ•°ç»„æŠ€å·§ç²¾è®²

å‰ç¼€å’ŒæŠ€å·§é€‚ç”¨äºå¿«é€Ÿã€é¢‘ç¹åœ°è®¡ç®—ä¸€ä¸ªç´¢å¼•åŒºé—´å†…çš„å…ƒç´ ä¹‹å’Œã€‚

ä¸€ç»´æ•°ç»„ä¸­çš„å‰ç¼€å’Œ
å…ˆçœ‹ä¸€é“ä¾‹é¢˜ï¼ŒåŠ›æ‰£ç¬¬ 303 é¢˜ã€Œ åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜ã€ï¼Œè®©ä½ è®¡ç®—æ•°ç»„åŒºé—´å†…å…ƒç´ çš„å’Œï¼Œè¿™æ˜¯ä¸€é“æ ‡å‡†çš„å‰ç¼€å’Œé—®é¢˜ï¼š


é¢˜ç›®è¦æ±‚ä½ å®ç°è¿™æ ·ä¸€ä¸ªç±»ï¼š

class NumArray {

    public NumArray(int[] nums) {}
    
    /* æŸ¥è¯¢é—­åŒºé—´ [left, right] çš„ç´¯åŠ å’Œ */
    public int sumRange(int left, int right) {}
}
sumRange å‡½æ•°éœ€è¦è®¡ç®—å¹¶è¿”å›ä¸€ä¸ªç´¢å¼•åŒºé—´ä¹‹å†…çš„å…ƒç´ å’Œï¼Œæ²¡å­¦è¿‡å‰ç¼€å’Œçš„äººå¯èƒ½å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š

class NumArray {

    private int[] nums;

    public NumArray(int[] nums) {
        this.nums = nums;
    }
    
    public int sumRange(int left, int right) {
        int res = 0;
        for (int i = left; i <= right; i++) {
            res += nums[i];
        }
        return res;
    }
}
è¿™æ ·ï¼Œå¯ä»¥è¾¾åˆ°æ•ˆæœï¼Œä½†æ˜¯æ•ˆç‡å¾ˆå·®ï¼Œå› ä¸º sumRange æ–¹æ³•ä¼šè¢«é¢‘ç¹è°ƒç”¨ï¼Œè€Œå®ƒçš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N)ï¼Œå…¶ä¸­ N ä»£è¡¨ nums æ•°ç»„çš„é•¿åº¦ã€‚

è¿™é“é¢˜çš„æœ€ä¼˜è§£æ³•æ˜¯ä½¿ç”¨å‰ç¼€å’ŒæŠ€å·§ï¼Œå°† sumRange å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦é™ä¸º O(1)ï¼Œè¯´ç™½äº†å°±æ˜¯ä¸è¦åœ¨ sumRange é‡Œé¢ç”¨ for å¾ªç¯ï¼Œå’‹æ•´ï¼Ÿ

ç›´æ¥çœ‹ä»£ç å®ç°ï¼š

class NumArray {
    // å‰ç¼€å’Œæ•°ç»„
    private int[] preSum;

    /* è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ„é€ å‰ç¼€å’Œ */
    public NumArray(int[] nums) {
        // preSum[0] = 0ï¼Œä¾¿äºè®¡ç®—ç´¯åŠ å’Œ
        preSum = new int[nums.length + 1];
        // è®¡ç®— nums çš„ç´¯åŠ å’Œ
        for (int i = 1; i < preSum.length; i++) {
            preSum[i] = preSum[i - 1] + nums[i - 1];
        }
    }
    
    /* æŸ¥è¯¢é—­åŒºé—´ [left, right] çš„ç´¯åŠ å’Œ */
    public int sumRange(int left, int right) {
        return preSum[right + 1] - preSum[left];
    }
}
æ ¸å¿ƒæ€è·¯æ˜¯æˆ‘ä»¬ new ä¸€ä¸ªæ–°çš„æ•°ç»„ preSum å‡ºæ¥ï¼ŒpreSum[i] è®°å½• nums[0..i-1] çš„ç´¯åŠ å’Œï¼Œçœ‹å›¾ 10 = 3 + 5 + 2ï¼š


çœ‹è¿™ä¸ª preSum æ•°ç»„ï¼Œå¦‚æœæˆ‘æƒ³æ±‚ç´¢å¼•åŒºé—´ [1, 4] å†…çš„æ‰€æœ‰å…ƒç´ ä¹‹å’Œï¼Œå°±å¯ä»¥é€šè¿‡ preSum[5] - preSum[1] å¾—å‡ºã€‚

è¿™æ ·ï¼ŒsumRange å‡½æ•°ä»…ä»…éœ€è¦åšä¸€æ¬¡å‡æ³•è¿ç®—ï¼Œé¿å…äº†æ¯æ¬¡è¿›è¡Œ for å¾ªç¯è°ƒç”¨ï¼Œæœ€åæ—¶é—´å¤æ‚åº¦ä¸ºå¸¸æ•° O(1)ã€‚

è¿™ä¸ªæŠ€å·§åœ¨ç”Ÿæ´»ä¸­è¿ç”¨ä¹ŸæŒºå¹¿æ³›çš„ï¼Œæ¯”æ–¹è¯´ï¼Œä½ ä»¬ç­ä¸Šæœ‰è‹¥å¹²åŒå­¦ï¼Œæ¯ä¸ªåŒå­¦æœ‰ä¸€ä¸ªæœŸæœ«è€ƒè¯•çš„æˆç»©ï¼ˆæ»¡åˆ† 100 åˆ†ï¼‰ï¼Œé‚£ä¹ˆè¯·ä½ å®ç°ä¸€ä¸ª APIï¼Œè¾“å…¥ä»»æ„ä¸€ä¸ªåˆ†æ•°æ®µï¼Œè¿”å›æœ‰å¤šå°‘åŒå­¦çš„æˆç»©åœ¨è¿™ä¸ªåˆ†æ•°æ®µå†…ã€‚

é‚£ä¹ˆï¼Œä½ å¯ä»¥å…ˆé€šè¿‡è®¡æ•°æ’åºçš„æ–¹å¼è®¡ç®—æ¯ä¸ªåˆ†æ•°å…·ä½“æœ‰å¤šå°‘ä¸ªåŒå­¦ï¼Œç„¶ååˆ©ç”¨å‰ç¼€å’ŒæŠ€å·§æ¥å®ç°åˆ†æ•°æ®µæŸ¥è¯¢çš„ APIï¼š

int[] scores; // å­˜å‚¨ç€æ‰€æœ‰åŒå­¦çš„åˆ†æ•°
// è¯•å·æ»¡åˆ† 100 åˆ†
int[] count = new int[100 + 1]
// è®°å½•æ¯ä¸ªåˆ†æ•°æœ‰å‡ ä¸ªåŒå­¦
for (int score : scores)
    count[score]++
// æ„é€ å‰ç¼€å’Œ
for (int i = 1; i < count.length; i++)
    count[i] = count[i] + count[i-1];

// åˆ©ç”¨ count è¿™ä¸ªå‰ç¼€å’Œæ•°ç»„è¿›è¡Œåˆ†æ•°æ®µæŸ¥è¯¢
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€çœ‹å‰ç¼€å’Œæ€è·¯åœ¨äºŒç»´æ•°ç»„ä¸­å¦‚ä½•è¿ç”¨ã€‚

äºŒç»´çŸ©é˜µä¸­çš„å‰ç¼€å’Œ
è¿™æ˜¯åŠ›æ‰£ç¬¬ 304 é¢˜ã€Œ äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜ã€ï¼Œå…¶å®å’Œä¸Šä¸€é¢˜ç±»ä¼¼ï¼Œä¸Šä¸€é¢˜æ˜¯è®©ä½ è®¡ç®—å­æ•°ç»„çš„å…ƒç´ ä¹‹å’Œï¼Œè¿™é“é¢˜è®©ä½ è®¡ç®—äºŒç»´çŸ©é˜µä¸­å­çŸ©é˜µçš„å…ƒç´ ä¹‹å’Œï¼š


æ¯”å¦‚è¯´è¾“å…¥çš„ matrix å¦‚ä¸‹å›¾ï¼š


æŒ‰ç…§é¢˜ç›®è¦æ±‚ï¼ŒçŸ©é˜µå·¦ä¸Šè§’ä¸ºåæ ‡åŸç‚¹ (0, 0)ï¼Œé‚£ä¹ˆ sumRegion([2,1,4,3]) å°±æ˜¯å›¾ä¸­çº¢è‰²çš„å­çŸ©é˜µï¼Œä½ éœ€è¦è¿”å›è¯¥å­çŸ©é˜µçš„å…ƒç´ å’Œ 8ã€‚

å½“ç„¶ï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªåµŒå¥— for å¾ªç¯å»éå†è¿™ä¸ªçŸ©é˜µï¼Œä½†è¿™æ ·çš„è¯ sumRegion å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦å°±é«˜äº†ï¼Œä½ ç®—æ³•çš„æ ¼å±€å°±ä½äº†ã€‚

æ³¨æ„ä»»æ„å­çŸ©é˜µçš„å…ƒç´ å’Œå¯ä»¥è½¬åŒ–æˆå®ƒå‘¨è¾¹å‡ ä¸ªå¤§çŸ©é˜µçš„å…ƒç´ å’Œçš„è¿ç®—ï¼š


è€Œè¿™å››ä¸ªå¤§çŸ©é˜µæœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œå°±æ˜¯å·¦ä¸Šè§’éƒ½æ˜¯ (0, 0) åŸç‚¹ã€‚

é‚£ä¹ˆåšè¿™é“é¢˜æ›´å¥½çš„æ€è·¯å’Œä¸€ç»´æ•°ç»„ä¸­çš„å‰ç¼€å’Œæ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªäºŒç»´ preSum æ•°ç»„ï¼Œä¸“é—¨è®°å½•ä»¥åŸç‚¹ä¸ºé¡¶ç‚¹çš„çŸ©é˜µçš„å…ƒç´ ä¹‹å’Œï¼Œå°±å¯ä»¥ç”¨å‡ æ¬¡åŠ å‡è¿ç®—ç®—å‡ºä»»ä½•ä¸€ä¸ªå­çŸ©é˜µçš„å…ƒç´ å’Œï¼š

class NumMatrix {
    // å®šä¹‰ï¼špreSum[i][j] è®°å½• matrix ä¸­å­çŸ©é˜µ [0, 0, i-1, j-1] çš„å…ƒç´ å’Œ
    private int[][] preSum;
    
    public NumMatrix(int[][] matrix) {
        int m = matrix.length, n = matrix[0].length;
        if (m == 0 || n == 0) return;
        // æ„é€ å‰ç¼€å’ŒçŸ©é˜µ
        preSum = new int[m + 1][n + 1];
        for (int i = 1; i <= m; i++) {
            for (int j = 1; j <= n; j++) {
                // è®¡ç®—æ¯ä¸ªçŸ©é˜µ [0, 0, i, j] çš„å…ƒç´ å’Œ
                preSum[i][j] = preSum[i-1][j] + preSum[i][j-1] + matrix[i - 1][j - 1] - preSum[i-1][j-1];
            }
        }
    }
    
    // è®¡ç®—å­çŸ©é˜µ [x1, y1, x2, y2] çš„å…ƒç´ å’Œ
    public int sumRegion(int x1, int y1, int x2, int y2) {
        // ç›®æ ‡çŸ©é˜µä¹‹å’Œç”±å››ä¸ªç›¸é‚»çŸ©é˜µè¿ç®—è·å¾—
        return preSum[x2+1][y2+1] - preSum[x1][y2+1] - preSum[x2+1][y1] + preSum[x1][y1];
    }
}
è¿™æ ·ï¼ŒsumRegion å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿç”¨å‰ç¼€å’ŒæŠ€å·§ä¼˜åŒ–åˆ°äº† O(1)ï¼Œè¿™æ˜¯å…¸å‹çš„ã€Œç©ºé—´æ¢æ—¶é—´ã€æ€è·¯ã€‚

å‰ç¼€å’ŒæŠ€å·§å°±è®²åˆ°è¿™é‡Œï¼Œåº”è¯¥è¯´è¿™ä¸ªç®—æ³•æŠ€å·§æ˜¯ä¼šè€…ä¸éš¾éš¾è€…ä¸ä¼šï¼Œå®é™…è¿ç”¨ä¸­è¿˜æ˜¯è¦å¤šåŸ¹å…»è‡ªå·±çš„æ€ç»´çµæ´»æ€§ï¼Œåšåˆ°ä¸€çœ¼çœ‹å‡ºé¢˜ç›®æ˜¯ä¸€ä¸ªå‰ç¼€å’Œé—®é¢˜ã€‚

é™¤äº†æœ¬æ–‡ä¸¾ä¾‹çš„åŸºæœ¬ç”¨æ³•ï¼Œå‰ç¼€å’Œæ•°ç»„ç»å¸¸å’Œå…¶ä»–æ•°æ®ç»“æ„æˆ–ç®—æ³•æŠ€å·§ç›¸ç»“åˆï¼Œæˆ‘ä¼šåœ¨ å‰ç¼€å’ŒæŠ€å·§é«˜é¢‘ä¹ é¢˜ ä¸­ä¸¾ä¾‹è®²è§£ã€‚