# æ—…æ¸¸çœé’±å¤§æ³•ï¼šåŠ æƒæœ€çŸ­è·¯å¾„



è¯»å®Œæœ¬æ–‡ï¼Œä½ ä¸ä»…å­¦ä¼šäº†ç®—æ³•å¥—è·¯ï¼Œè¿˜å¯ä»¥é¡ºä¾¿è§£å†³å¦‚ä¸‹é¢˜ç›®ï¼š

|                           LeetCode                           |                             åŠ›æ‰£                             | éš¾åº¦ |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :--: |
| [787. Cheapest Flights Within K Stopsopen in new window](https://leetcode.com/problems/cheapest-flights-within-k-stops/) | [787. K ç«™ä¸­è½¬å†…æœ€ä¾¿å®œçš„èˆªç­open in new window](https://leetcode.cn/problems/cheapest-flights-within-k-stops/) |  ğŸŸ    |

æ¯•ä¸šå­£ï¼Œå¯¹è¿‡å»ä¹Ÿè®¸æœ‰äº›æ¬¢ä¹å’Œæ„Ÿä¼¤ï¼Œå¯¹æœªæ¥ä¹Ÿè®¸æœ‰äº›è¿·èŒ«å’Œå‘å¾€ï¼Œä¸è¿‡è¿™äº›ç»ˆç©¶æ˜¯è¿‡çœ¼äº‘çƒŸï¼Œè¿Ÿæ—©ä¼šè¢«æ—¶é—´æ·¡åŒ–å’Œé—å¿˜ã€‚

åœ¨è¿™æ®µç¾å¥½æ—¶å…‰çš„æœ«å°¾ï¼Œç¡®å®åº”è¯¥æ¥ä¸€åœºè¯´èµ°å°±èµ°çš„æ¯•ä¸šæ—…è¡Œï¼Œæ”¾è‚†ä¸€æŠŠï¼Œç»™é’æ˜¥ç”»ä¸Šä¸€ä¸ªå®Œç¾çš„å¥å·ã€‚

é‚£ä¹ˆï¼Œæœ¬æ–‡å°±æ•™ç»™ä½ ä¸€ä¸ªåŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œåœ¨æ¯•ä¸šæ—…è¡Œä¸­çœé’± èŠ‚çº¦è¿½æ±‚è¯—å’Œè¿œæ–¹çš„èµ„æœ¬ã€‚

![img](https://labuladong.github.io/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/6.png)

å‡è®¾ï¼Œä½ å‡†å¤‡ä»å­¦æ ¡æ‰€åœ¨çš„åŸå¸‚å‡ºå‘ï¼Œæ¸¸å†å¤šä¸ªåŸå¸‚ï¼Œä¸€è·¯æµªåˆ°å…¬å¸å…¥èŒï¼Œé‚£ä¹ˆä½ åº”è¯¥å¦‚ä½•å®‰æ’æ—…æ¸¸è·¯çº¿ï¼Œæ‰èƒ½æœ€å°åŒ–æœºç¥¨çš„å¼€é”€ï¼Ÿ

æˆ‘ä»¬æ¥çœ‹çœ‹åŠ›æ‰£ç¬¬ 787 é¢˜ã€Œ[K ç«™ä¸­è½¬å†…æœ€ä¾¿å®œçš„èˆªç­open in new window](https://leetcode.cn/problems/cheapest-flights-within-k-stops/)ã€ï¼Œæˆ‘æè¿°ä¸€ä¸‹é¢˜ç›®ï¼š

ç°åœ¨æœ‰ `n` ä¸ªåŸå¸‚ï¼Œåˆ†åˆ«ç”¨ `0`, `1`..., `n - 1` è¿™äº›åºå·è¡¨ç¤ºï¼ŒåŸå¸‚ä¹‹é—´çš„èˆªçº¿ç”¨ä¸‰å…ƒç»„ `[from, to, price]` æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚è¯´ä¸‰å…ƒç»„ `[0,1,100]` å°±è¡¨ç¤ºï¼Œä»åŸå¸‚ `0` åˆ°åŸå¸‚ `1` ä¹‹é—´çš„æœºç¥¨ä»·æ ¼æ˜¯ 100 å…ƒã€‚

é¢˜ç›®ä¼šç»™ä½ è¾“å…¥è‹¥å¹²å‚æ•°ï¼šæ­£æ•´æ•° `n` ä»£è¡¨åŸå¸‚ä¸ªæ•°ï¼Œæ•°ç»„ `flights` è£…ç€è‹¥å¹²ä¸‰å…ƒç»„ä»£è¡¨åŸå¸‚é—´çš„èˆªçº¿åŠä»·æ ¼ï¼ŒåŸå¸‚ç¼–å· `src` ä»£è¡¨ä½ æ‰€åœ¨çš„åŸå¸‚ï¼ŒåŸå¸‚ç¼–å· `dst` ä»£è¡¨ä½ è¦å»çš„ç›®æ ‡åŸå¸‚ï¼Œæ•´æ•° `K` ä»£è¡¨ä½ æœ€å¤šç»è¿‡çš„ä¸­è½¬ç«™ä¸ªæ•°ã€‚

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

java ğŸŸ¢cpp ğŸ¤–python ğŸ¤–go ğŸ¤–javascript ğŸ¤–



```java
int findCheapestPrice(int n, int[][] flights, int src, int dst, int K);
```

è¯·ä½ çš„ç®—æ³•è®¡ç®—ï¼Œåœ¨ `K` æ¬¡ä¸­è½¬ä¹‹å†…ï¼Œä» `src` åˆ° `dst` æ‰€éœ€çš„æœ€å°èŠ±è´¹æ˜¯å¤šå°‘é’±ï¼Œå¦‚æœæ— æ³•åˆ°è¾¾ï¼Œåˆ™è¿”å› -1ã€‚

æ¯”æ–¹è¯´é¢˜ç›®ç»™çš„ä¾‹å­ï¼š

```
n = 3, flights = [[0,1,100],[1,2,100],[0,2,500]], src = 0, dst = 2, K = 1
```

èˆªçº¿å°±æ˜¯å¦‚ä¸‹è¿™å¼ å›¾æ‰€ç¤ºï¼Œæœ‰å‘è¾¹ä»£è¡¨èˆªå‘çš„æ–¹å‘ï¼Œè¾¹ä¸Šçš„æ•°å­—ä»£è¡¨èˆªçº¿çš„æœºç¥¨ä»·æ ¼ï¼š

![img](https://labuladong.github.io/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/7.png)

å‡ºå‘ç‚¹æ˜¯ `0`ï¼Œåˆ°è¾¾ç‚¹æ˜¯ `2`ï¼Œå…è®¸çš„æœ€å¤§ä¸­è½¬æ¬¡æ•° `K` ä¸º 1ï¼Œæ‰€ä»¥æœ€å°çš„å¼€é”€å°±æ˜¯å›¾ä¸­çº¢è‰²çš„ä¸¤æ¡è¾¹ï¼Œä» `0` å‡ºå‘ï¼Œç»è¿‡ä¸­è½¬åŸå¸‚ `1` åˆ°è¾¾ç›®æ ‡åŸå¸‚ `2`ï¼Œæ‰€ä»¥ç®—æ³•çš„è¿”å›å€¼åº”è¯¥æ˜¯ 200ã€‚

æ³¨æ„è¿™ä¸ªä¸­è½¬æ¬¡æ•°çš„ä¸Šé™ `K` æ˜¯æ¯”è¾ƒæ£˜æ‰‹çš„ï¼Œå¦‚æœä¸Šè¿°é¢˜ç›®å°† `K` æ”¹ä¸º 0ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸ä¸­è½¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç®—æ³•åªèƒ½è¿”å› 500 äº†ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥ä» `0` é£åˆ° `2`ã€‚

**å¾ˆæ˜æ˜¾ï¼Œè¿™é¢˜å°±æ˜¯ä¸ªåŠ æƒæœ‰å‘å›¾ä¸­æ±‚æœ€çŸ­è·¯å¾„çš„é—®é¢˜**ã€‚

è¯´ç™½äº†ï¼Œå°±æ˜¯ç»™ä½ ä¸€å¹…åŠ æƒæœ‰å‘å›¾ï¼Œè®©ä½ æ±‚ `src` åˆ° `dst` æƒé‡æœ€å°çš„ä¸€æ¡è·¯å¾„ï¼ŒåŒæ—¶è¦æ»¡è¶³ï¼Œ**è¿™æ¡è·¯å¾„æœ€å¤šä¸èƒ½è¶…è¿‡ `K + 1` æ¡è¾¹**ï¼ˆç»è¿‡ `K` ä¸ªèŠ‚ç‚¹ç›¸å½“äºç»è¿‡ `K + 1` æ¡è¾¹ï¼‰ã€‚

æˆ‘ä»¬æ¥åˆ†æä¸‹æ±‚æœ€çŸ­è·¯å¾„ç›¸å…³çš„ç®—æ³•ã€‚

### [#](https://labuladong.github.io/algo/di-er-zhan-a01c6/yong-dong--63ceb/lv-you-she-f3b76/#bfs-ç®—æ³•æ€è·¯)BFS ç®—æ³•æ€è·¯

æˆ‘ä»¬å‰æ–‡ [BFS ç®—æ³•æ¡†æ¶è¯¦è§£](https://labuladong.github.io/algo/di-ling-zh-bfe1b/bfs-suan-f-463fd/) ä¸­è¯´åˆ°ï¼Œæ±‚æœ€çŸ­è·¯å¾„ï¼Œè‚¯å®šå¯ä»¥ç”¨ BFS ç®—æ³•æ¥è§£å†³ã€‚

å› ä¸º BFS ç®—æ³•ç›¸å½“äºä»èµ·å§‹ç‚¹å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥å‘å¤–æ‰©æ•£ï¼Œé‚£å½“ç„¶æ˜¯ç¦»èµ·ç‚¹è¶Šè¿‘çš„èŠ‚ç‚¹è¶Šå…ˆè¢«éå†åˆ°ï¼Œå¦‚æœ BFS éå†çš„è¿‡ç¨‹ä¸­é‡åˆ°ç»ˆç‚¹ï¼Œé‚£ä¹ˆèµ°çš„è‚¯å®šæ˜¯æœ€çŸ­è·¯å¾„ã€‚

ä¸è¿‡å‘¢ï¼Œæˆ‘ä»¬åœ¨ [BFS ç®—æ³•æ¡†æ¶è¯¦è§£](https://labuladong.github.io/algo/di-ling-zh-bfe1b/bfs-suan-f-463fd/) ç”¨çš„æ˜¯æ™®é€šçš„é˜Ÿåˆ— `Queue` æ¥éå†å¤šå‰æ ‘ï¼Œè€Œå¯¹äºåŠ æƒå›¾çš„æœ€çŸ­è·¯å¾„æ¥è¯´ï¼Œæ™®é€šçš„é˜Ÿåˆ—ä¸ç®¡ç”¨äº†ï¼Œå¾—ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ— `PriorityQueue`ã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¹Ÿå¥½ç†è§£ï¼Œåœ¨å¤šå‰æ ‘ï¼ˆæˆ–è€…æ‰©å±•åˆ°æ— æƒå›¾ï¼‰çš„éå†ä¸­ï¼Œä¸å…¶è¯´è¾¹æ²¡æœ‰æƒé‡ï¼Œä¸å¦‚è¯´æ¯æ¡è¾¹çš„æƒé‡éƒ½æ˜¯ 1ï¼Œèµ·ç‚¹ä¸ç»ˆç‚¹ä¹‹é—´çš„è·¯å¾„æƒé‡å°±æ˜¯å®ƒä»¬ä¹‹é—´ã€Œè¾¹ã€çš„æ¡æ•°ã€‚

è¿™æ ·ï¼ŒæŒ‰ç…§ BFS ç®—æ³•ä¸€æ­¥æ­¥å‘å››å‘¨æ‰©æ•£çš„é€»è¾‘ï¼Œå…ˆéå†åˆ°çš„èŠ‚ç‚¹å’Œèµ·ç‚¹ä¹‹é—´çš„ã€Œè¾¹ã€æ›´å°‘ï¼Œç´¯è®¡çš„æƒé‡å½“ç„¶å°‘ã€‚

æ¢è¨€ä¹‹ï¼Œå…ˆè¿›å…¥ `Queue` çš„èŠ‚ç‚¹å°±æ˜¯ç¦»èµ·ç‚¹è¿‘çš„ï¼Œè·¯å¾„æƒé‡å°çš„èŠ‚ç‚¹ã€‚

ä½†å¯¹äºåŠ æƒå›¾ï¼Œè·¯å¾„ä¸­è¾¹çš„æ¡æ•°å’Œè·¯å¾„çš„æƒé‡å¹¶ä¸æ˜¯æ­£ç›¸å…³çš„å…³ç³»äº†ï¼Œæœ‰çš„è·¯å¾„å¯èƒ½è¾¹çš„æ¡æ•°å¾ˆå°‘ï¼Œä½†æ¯æ¡è¾¹çš„æƒé‡éƒ½å¾ˆå¤§ï¼Œé‚£æ˜¾ç„¶è¿™æ¡è·¯å¾„æƒé‡ä¹Ÿä¼šå¾ˆå¤§ï¼Œå¾ˆéš¾æˆä¸ºæœ€çŸ­è·¯å¾„ã€‚

æ¯”å¦‚é¢˜ç›®ç»™çš„è¿™ä¸ªä¾‹å­ï¼š

![img](https://labuladong.github.io/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/7.png)

ä½ æ˜¯å¯ä»¥ä¸€æ­¥ä» `0` èµ°åˆ° `2`ï¼Œä½†è·¯å¾„æƒé‡ä¸è§å¾—æ˜¯æœ€å°çš„ã€‚

æ‰€ä»¥ï¼Œå¯¹äºåŠ æƒå›¾çš„åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ä¼˜å…ˆçº§é˜Ÿåˆ—ã€Œè‡ªåŠ¨æ’åºã€çš„ç‰¹æ€§ï¼Œå°†è·¯å¾„æƒé‡è¾ƒå°çš„èŠ‚ç‚¹æ’åœ¨é˜Ÿåˆ—å‰é¢ï¼Œä»¥æ­¤ä¸ºåŸºç¡€æ–½å±• BFS ç®—æ³•ï¼Œä¹Ÿå°±å˜æˆäº† [Dijkstra ç®—æ³•](https://labuladong.github.io/algo/di-yi-zhan-da78c/shou-ba-sh-03a72/dijkstra-s-6d0b2/)ã€‚

è¯´äº†è¿™ä¹ˆå¤š BFS ç®—æ³•æ€è·¯ï¼Œåªæ˜¯å¸®åŠ©å¤§å®¶èä¼šè´¯é€šä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ¬æ–‡å‡†å¤‡ç”¨åŠ¨æ€è§„åˆ’æ¥è§£å†³è¿™é“é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬å…¬ä¼—å·å¥½ä¹…æ²¡æœ‰å†™åŠ¨æ€è§„åˆ’ç›¸å…³çš„ç®—æ³•äº†ï¼Œå…³äº Dijkstra ç®—æ³•çš„å®ç°ä»£ç ï¼Œæ–‡æœ«æœ‰å†™ï¼Œä¾›è¯»è€…å‚è€ƒã€‚

### [#](https://labuladong.github.io/algo/di-er-zhan-a01c6/yong-dong--63ceb/lv-you-she-f3b76/#åŠ¨æ€è§„åˆ’æ€è·¯)åŠ¨æ€è§„åˆ’æ€è·¯

æˆ‘ä»¬å‰æ–‡ [åŠ¨æ€è§„åˆ’æ ¸å¿ƒå¥—è·¯è¯¦è§£](https://labuladong.github.io/algo/di-ling-zh-bfe1b/dong-tai-g-1e688/) ä¸­è¯´è¿‡ï¼Œæ±‚æœ€å€¼çš„é—®é¢˜ï¼Œå¾ˆå¤šéƒ½å¯èƒ½ä½¿ç”¨åŠ¨æ€è§„åˆ’æ¥æ±‚è§£ã€‚

åŠ æƒæœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œå†åŠ ä¸ª `K` çš„é™åˆ¶ä¹Ÿæ— å¦¨ï¼Œä¸ä¹Ÿæ˜¯ä¸ªæ±‚æœ€å€¼çš„é—®é¢˜å˜›ï¼ŒåŠ¨æ€è§„åˆ’ç»Ÿç»Ÿæ‹¿ä¸‹ã€‚

æˆ‘ä»¬å…ˆä¸ç®¡ `K` çš„é™åˆ¶ï¼Œå•å°±ã€ŒåŠ æƒæœ€çŸ­è·¯å¾„ã€è¿™ä¸ªé—®é¢˜æ¥çœ‹çœ‹ï¼Œå®ƒæ€ä¹ˆå°±æ˜¯ä¸ªåŠ¨æ€è§„åˆ’é—®é¢˜äº†å‘¢ï¼Ÿ

æ¯”æ–¹è¯´ï¼Œç°åœ¨æˆ‘æƒ³è®¡ç®— `src` åˆ° `dst` çš„æœ€çŸ­è·¯å¾„ï¼š

![img](https://labuladong.github.io/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/1.jpeg)

æœ€å°æƒé‡æ˜¯å¤šå°‘ï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚

ä½†æˆ‘å¯ä»¥æŠŠé—®é¢˜è¿›è¡Œåˆ†è§£ï¼š

![img](https://labuladong.github.io/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/2.jpeg)

`s1, s2` æ˜¯æŒ‡å‘ `dst` çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œå®ƒä»¬ä¹‹é—´çš„æƒé‡æˆ‘æ˜¯çŸ¥é“çš„ï¼Œåˆ†åˆ«æ˜¯ `w1, w2`ã€‚

åªè¦æˆ‘çŸ¥é“äº†ä» `src` åˆ° `s1, s2` çš„æœ€çŸ­è·¯å¾„ï¼Œæˆ‘ä¸å°±çŸ¥é“ `src` åˆ° `dst` çš„æœ€çŸ­è·¯å¾„äº†å—ï¼



```java
minPath(src, dst) = min(
    minPath(src, s1) + w1, 
    minPath(src, s2) + w2
)
```

è¿™å…¶å®å°±æ˜¯é€’å½’å…³ç³»äº†ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚

**ä¸è¿‡åˆ«å¿˜äº†ï¼Œé¢˜ç›®å¯¹æˆ‘ä»¬çš„æœ€çŸ­è·¯å¾„è¿˜æœ‰ä¸ªã€Œè·¯å¾„ä¸Šä¸èƒ½è¶…è¿‡ `K + 1` æ¡è¾¹ã€çš„é™åˆ¶**ã€‚

é‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨å®šä¹‰è¿™æ ·ä¸€ä¸ª `dp` å‡½æ•°ï¼š

java ğŸŸ¢cpp ğŸ¤–python ğŸ¤–go ğŸ¤–javascript ğŸ¤–



```java
int dp(int s, int k);
```

å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š

**ä»èµ·ç‚¹ `src` å‡ºå‘ï¼Œ`k` æ­¥ä¹‹å†…ï¼ˆä¸€æ­¥å°±æ˜¯ä¸€æ¡è¾¹ï¼‰åˆ°è¾¾èŠ‚ç‚¹ `s` çš„æœ€å°è·¯å¾„æƒé‡ä¸º `dp(s, k)`**ã€‚

é‚£ä¹ˆï¼Œ`dp` å‡½æ•°çš„ base case å°±æ˜¾è€Œæ˜“è§äº†ï¼š

java ğŸŸ¢cpp ğŸ¤–python ğŸ¤–go ğŸ¤–javascript ğŸ¤–



```java
// å®šä¹‰ï¼šä» src å‡ºå‘ï¼Œk æ­¥ä¹‹å†…åˆ°è¾¾ s çš„æœ€å°æˆæœ¬
int dp(int s, int k) {
    // ä» src åˆ° srcï¼Œä¸€æ­¥éƒ½ä¸ç”¨èµ°
    if (s == src) {
        return 0;
    }
    // å¦‚æœæ­¥æ•°ç”¨å°½ï¼Œå°±æ— è§£äº†
    if (k == 0) {
        return -1;
    }

    // ...
}
```

é¢˜ç›®æƒ³æ±‚çš„æœ€å°æœºç¥¨å¼€é”€å°±å¯ä»¥ç”¨ `dp(dst, K+1)` æ¥è¡¨ç¤ºï¼š

java ğŸŸ¢cpp ğŸ¤–python ğŸ¤–go ğŸ¤–javascript ğŸ¤–



```java
int findCheapestPrice(int n, int[][] flights, int src, int dst, int K) {
    // å°†ä¸­è½¬ç«™ä¸ªæ•°è½¬åŒ–æˆè¾¹çš„æ¡æ•°
    K++;
    //...
    return dp(dst, K);
```

æ·»åŠ äº†ä¸€ä¸ª `K` æ¡è¾¹çš„é™åˆ¶ï¼ŒçŠ¶æ€è½¬ç§»æ–¹ç¨‹æ€ä¹ˆå†™å‘¢ï¼Ÿå…¶å®å’Œåˆšæ‰æ˜¯ä¸€æ ·çš„ï¼š

![img](https://labuladong.github.io/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/3.jpeg)

`K` æ­¥ä¹‹å†…ä» `src` åˆ° `dst` çš„æœ€å°è·¯å¾„æƒé‡æ˜¯å¤šå°‘ï¼Ÿæˆ‘ä¸çŸ¥é“ã€‚

ä½†æˆ‘å¯ä»¥æŠŠé—®é¢˜åˆ†è§£ï¼š

![img](https://labuladong.github.io/algo/images/%E6%97%85%E8%A1%8C%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84/4.jpeg)

`s1, s2` æ˜¯æŒ‡å‘ `dst` çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œæˆ‘åªè¦çŸ¥é“ `K - 1` æ­¥ä¹‹å†…ä» `src` åˆ°è¾¾ `s1, s2`ï¼Œé‚£æˆ‘å°±å¯ä»¥åœ¨ `K` æ­¥ä¹‹å†…ä» `src` åˆ°è¾¾ `dst`ã€‚

ä¹Ÿå°±æ˜¯å¦‚ä¸‹å…³ç³»å¼ï¼š



```java
dp(dst, k) = min(
    dp(s1, k - 1) + w1, 
    dp(s2, k - 1) + w2
)
```

è¿™å°±æ˜¯æ–°çš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå¦‚æœä½ èƒ½çœ‹æ‡‚è¿™ä¸ªç®—å¼ï¼Œå°±å·²ç»å¯ä»¥è§£å†³è¿™é“é¢˜äº†ã€‚

### [#](https://labuladong.github.io/algo/di-er-zhan-a01c6/yong-dong--63ceb/lv-you-she-f3b76/#ä»£ç å®ç°)ä»£ç å®ç°

æ ¹æ®ä¸Šè¿°æ€è·¯ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“ `s1, s2` æ˜¯æŒ‡å‘ `dst` çš„ç›¸é‚»èŠ‚ç‚¹ï¼Œä»–ä»¬ä¹‹é—´çš„æƒé‡æ˜¯ `w1, w2`ï¼Ÿ

æˆ‘å¸Œæœ›ç»™ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±èƒ½çŸ¥é“æœ‰è°æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹ï¼Œè¿˜çŸ¥é“å®ƒä»¬ä¹‹é—´çš„æƒé‡ï¼Œå¯¹å§ã€‚

ä¸“ä¸šç‚¹è¯´ï¼Œå¾—ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„è®°å½•æ¯ä¸ªèŠ‚ç‚¹çš„ã€Œå…¥åº¦ã€indegreeï¼š

java ğŸŸ¢cpp ğŸ¤–python ğŸ¤–go ğŸ¤–javascript ğŸ¤–



```java
// å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªç‚¹çš„å…¥åº¦
// to -> [from, price]
HashMap<Integer, List<int[]>> indegree;
int src, dst;

public int findCheapestPrice(int n, int[][] flights, int src, int dst, int K) {
    // å°†ä¸­è½¬ç«™ä¸ªæ•°è½¬åŒ–æˆè¾¹çš„æ¡æ•°
    K++;
    this.src = src;
    this.dst = dst;
    
    indegree = new HashMap<>();
    for (int[] f : flights) {
        int from = f[0];
        int to = f[1];
        int price = f[2];
        // è®°å½•è°æŒ‡å‘è¯¥èŠ‚ç‚¹ï¼Œä»¥åŠä¹‹é—´çš„æƒé‡
        indegree.putIfAbsent(to, new LinkedList<>());
        indegree.get(to).add(new int[] {from, price});
    }
    
    return dp(dst, K);
}
```

æœ‰äº† `indegree` å­˜å‚¨å…¥åº¦ï¼Œé‚£ä¹ˆå°±å¯ä»¥å…·ä½“å®ç° `dp` å‡½æ•°äº†ï¼š

java ğŸŸ¢cpp ğŸ¤–python ğŸ¤–go ğŸ¤–javascript ğŸ¤–



```java
// å®šä¹‰ï¼šä» src å‡ºå‘ï¼Œk æ­¥ä¹‹å†…åˆ°è¾¾ s çš„æœ€çŸ­è·¯å¾„æƒé‡
int dp(int s, int k) {
    // base case
    if (s == src) {
        return 0;
    }
    if (k == 0) {
        return -1;
    }
    // åˆå§‹åŒ–ä¸ºæœ€å¤§å€¼ï¼Œæ–¹ä¾¿ç­‰ä¼šå–æœ€å°å€¼
    int res = Integer.MAX_VALUE;
    if (indegree.containsKey(s)) {
        // å½“ s æœ‰å…¥åº¦èŠ‚ç‚¹æ—¶ï¼Œåˆ†è§£ä¸ºå­é—®é¢˜
        for (int[] v : indegree.get(s)) {
            int from = v[0];
            int price = v[1];
            // ä» src åˆ°è¾¾ç›¸é‚»çš„å…¥åº¦èŠ‚ç‚¹æ‰€éœ€çš„æœ€çŸ­è·¯å¾„æƒé‡
            int subProblem = dp(from, k - 1);



            // è·³è¿‡æ— è§£çš„æƒ…å†µ
            if (subProblem != -1) {
                res = Math.min(res, subProblem + price);
            }
        }
    }
    // å¦‚æœè¿˜æ˜¯åˆå§‹å€¼ï¼Œè¯´æ˜æ­¤èŠ‚ç‚¹ä¸å¯è¾¾
    return res == Integer.MAX_VALUE ? -1 : res;
}
```

æœ‰ä¹‹å‰çš„é“ºå«ï¼Œè¿™æ®µè§£æ³•é€»è¾‘åº”è¯¥æ˜¯å¾ˆæ¸…æ™°çš„ã€‚å½“ç„¶ï¼Œå¯¹äºåŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œè‚¯å®šè¦æ¶ˆé™¤é‡å å­é—®é¢˜ã€‚

ä¸ºä»€ä¹ˆæœ‰é‡å å­é—®é¢˜ï¼Ÿå¾ˆç®€å•ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹åŒæ—¶æŒ‡å‘ä¸¤ä¸ªå…¶ä»–èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªèŠ‚ç‚¹å°±æœ‰ç›¸åŒçš„ä¸€ä¸ªå…¥åº¦èŠ‚ç‚¹ï¼Œå°±ä¼šäº§ç”Ÿé‡å¤çš„é€’å½’è®¡ç®—ã€‚

æ€ä¹ˆæ¶ˆé™¤é‡å å­é—®é¢˜ï¼Ÿæ‰¾é—®é¢˜çš„ã€ŒçŠ¶æ€ã€ã€‚

çŠ¶æ€æ˜¯ä»€ä¹ˆï¼Ÿåœ¨é—®é¢˜åˆ†è§£ï¼ˆçŠ¶æ€è½¬ç§»ï¼‰çš„è¿‡ç¨‹ä¸­å˜åŒ–çš„ï¼Œå°±æ˜¯çŠ¶æ€ã€‚

**è°åœ¨å˜åŒ–ï¼Ÿæ˜¾ç„¶å°±æ˜¯ `dp` å‡½æ•°çš„å‚æ•° `s` å’Œ `k`ï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨ï¼Œç›®æ ‡ç‚¹ `s` å’Œæ­¥æ•°çº¦æŸ `k` åœ¨å˜åŒ–**ã€‚

æ‰€ä»¥ï¼Œæœ¬é¢˜çš„çŠ¶æ€æœ‰ä¸¤ä¸ªï¼Œåº”è¯¥ç®—æ˜¯äºŒç»´åŠ¨æ€è§„åˆ’ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª `memo` äºŒç»´æ•°ç»„æˆ–è€…å“ˆå¸Œè¡¨ä½œä¸ºå¤‡å¿˜å½•ï¼Œå‡å°‘é‡å¤è®¡ç®—ã€‚

æˆ‘ä»¬é€‰ç”¨äºŒç»´æ•°ç»„åšå¤‡å¿˜å½•å§ï¼Œæ³¨æ„ `K` æ˜¯ä» 1 å¼€å§‹ç®—çš„ï¼Œæ‰€ä»¥å¤‡å¿˜å½•åˆå§‹å¤§å°è¦å†åŠ ä¸€ï¼š

java ğŸŸ¢cpp ğŸ¤–python ğŸ¤–go ğŸ¤–javascript ğŸ¤–



```java
int src, dst;
HashMap<Integer, List<int[]>> indegree;
// å¤‡å¿˜å½•
int[][] memo;

public int findCheapestPrice(int n, int[][] flights, int src, int dst, int K) {
    K++;
    this.src = src;
    this.dst = dst;
    // åˆå§‹åŒ–å¤‡å¿˜å½•ï¼Œå…¨éƒ¨å¡«ä¸€ä¸ªç‰¹æ®Šå€¼
    memo = new int[n][K + 1];
    for (int[] row : memo) {
        Arrays.fill(row, -888);
    }
    
    // å…¶ä»–ä¸å˜
    // ...
    
    return dp(dst, K);
}

// å®šä¹‰ï¼šä» src å‡ºå‘ï¼Œk æ­¥ä¹‹å†…åˆ°è¾¾ s çš„æœ€å°æˆæœ¬
int dp(int s, int k) {
    // base case
    if (s == src) {
        return 0;
    }
    if (k == 0) {
        return -1;
    }
    // æŸ¥å¤‡å¿˜å½•ï¼Œé˜²æ­¢å†—ä½™è®¡ç®—
    if (memo[s][k] != -888) {
        return memo[s][k];
    }
    
    // çŠ¶æ€è½¬ç§»ä¸å˜
    // ...
    
    // å­˜å…¥å¤‡å¿˜å½•
    memo[s][k] = res == Integer.MAX_VALUE ? -1 : res;
    return memo[s][k];
}
```

<details data-v-4fb811c9="" id="div_cheapest-flights-within-k-stops" class="hint-container details" style="position: relative; transition: background var(--vp-tt),color var(--vp-tt); display: block; margin: 1.6em 0px; padding: 1rem 0px 0px; border-radius: 0.5rem; background: var(--detail-bg-color); color: var(--detail-text-color);"><summary data-v-4fb811c9="" style="position: relative; margin: -1.5rem 0px -0.5rem; padding-top: 1.5rem; padding-bottom: 1.5rem; padding-inline: 4rem 1.5rem; list-style: none; cursor: pointer; display: flex; align-items: center; font-size: large;"><strong data-v-4fb811c9="" style="font-weight: 600;">ğŸ­ ä»£ç å¯è§†åŒ–åŠ¨ç”» ğŸ­</strong><span data-v-4fb811c9="" class="font-icon icon iconfont icon-resize" style="display: inline-block; font-size: 16px; font-style: normal; -webkit-font-smoothing: antialiased; font-family: iconfont !important; vertical-align: middle; margin-left: auto; margin-right: 10px;"></span><span data-v-4fb811c9="" class="font-icon icon iconfont icon-refresh" style="display: inline-block; font-size: 16px; font-style: normal; -webkit-font-smoothing: antialiased; font-family: iconfont !important; vertical-align: middle; margin-right: 10px;"></span><span data-v-4fb811c9="" class="font-icon icon iconfont icon-link" style="display: inline-block; font-size: 16px; font-style: normal; -webkit-font-smoothing: antialiased; font-family: iconfont !important; vertical-align: middle;"></span></summary><div data-v-4fb811c9="" class="resizable" style="width: 752px; max-width: 100%; height: 70vh; max-height: 70vh; overflow: auto; resize: both;"><iframe data-v-4fb811c9="" id="iframe_cheapest-flights-within-k-stops" src="https://labuladong.github.io/algo-visualize/" width="100%" height="100%" loading="lazy" scrolling="auto" frameborder="0" style="overflow: auto;"></iframe></div></details>

å¤‡å¿˜å½•åˆå§‹å€¼ä¸ºå•¥åˆå§‹ä¸º -888ï¼Ÿå‰æ–‡ [base case å’Œå¤‡å¿˜å½•çš„åˆå§‹å€¼æ€ä¹ˆå®š](https://labuladong.github.io/algo/di-er-zhan-a01c6/dong-tai-g-a223e/basecase-h-de925/) è¯´è¿‡ï¼Œéšä¾¿åˆå§‹åŒ–ä¸€ä¸ªæ— æ„ä¹‰çš„å€¼å°±è¡Œã€‚

è‡³æ­¤ï¼Œè¿™é“é¢˜å°±é€šè¿‡è‡ªé¡¶å‘ä¸‹çš„é€’å½’æ–¹å¼è§£å†³äº†ã€‚å½“ç„¶ï¼Œå®Œå…¨å¯ä»¥æŒ‰ç…§è¿™ä¸ªè§£æ³•è¡ç”Ÿå‡ºè‡ªåº•å‘ä¸Šè¿­ä»£çš„åŠ¨æ€è§„åˆ’è§£æ³•ï¼Œä½†ç”±äºç¯‡å¹…æ‰€é™ï¼Œæˆ‘å°±ä¸å†™äº†ï¼Œåæ­£æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ã€‚

å…¶å®ï¼Œå¤§å®¶å¦‚æœæŠŠæˆ‘ä»¬å·ä¹‹å‰çš„æ‰€æœ‰åŠ¨æ€è§„åˆ’æ–‡ç« éƒ½çœ‹ä¸€éï¼Œå°±ä¼šå‘ç°æˆ‘ä»¬ä¸€ç›´åœ¨å¥—ç”¨ [åŠ¨æ€è§„åˆ’æ ¸å¿ƒå¥—è·¯](https://labuladong.github.io/algo/di-ling-zh-bfe1b/dong-tai-g-1e688/)ï¼Œå…¶å®çœŸæ²¡ä»€ä¹ˆå›°éš¾çš„ã€‚

æœ€åæ‰©å±•ä¸€ä¸‹ï¼Œæœ‰çš„è¯»è€…å¯èƒ½ä¼šé—®ï¼šæ—¢ç„¶è¿™ä¸ªé—®é¢˜æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå›¾çš„éå†é—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸éœ€è¦ `visited` é›†åˆè®°å½•å·²ç»è®¿é—®è¿‡çš„èŠ‚ç‚¹ï¼Ÿ

è¿™ä¸ªé—®é¢˜æˆ‘åœ¨ [Dijkstra ç®—æ³•æ¨¡æ¿](https://labuladong.github.io/algo/di-yi-zhan-da78c/shou-ba-sh-03a72/dijkstra-s-6d0b2/) ä¸­æ¢è®¨è¿‡ï¼Œå¯ä»¥å»çœ‹çœ‹ã€‚å¦å¤–ï¼Œè¿™é¢˜ä¹Ÿå¯ä»¥åˆ©ç”¨ Dijkstra ç®—æ³•æ¨¡æ¿æ¥è§£å†³ï¼Œä»£ç å¦‚ä¸‹ï¼š

java ğŸŸ¢cpp ğŸ¤–python ğŸ¤–go ğŸ¤–javascript ğŸ¤–



```java
public int findCheapestPrice(int n, int[][] flights, int src, int dst, int K) {
    List<int[]>[] graph = new LinkedList[n];
    for (int i = 0; i < n; i++) {
        graph[i] = new LinkedList<>();
    }
    for (int[] edge : flights) {
        int from = edge[0];
        int to = edge[1];
        int price = edge[2];
        graph[from].add(new int[]{to, price});
    }

    // å¯åŠ¨ dijkstra ç®—æ³•
    // è®¡ç®—ä»¥ src ä¸ºèµ·ç‚¹åœ¨ k æ¬¡ä¸­è½¬åˆ°è¾¾ dst çš„æœ€çŸ­è·¯å¾„
    K++;
    return dijkstra(graph, src, K, dst);
}

class State {
    // å›¾èŠ‚ç‚¹çš„ id
    int id;
    // ä» src èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„èŠ±è´¹
    int costFromSrc;
    // ä» src èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹ç»è¿‡çš„èŠ‚ç‚¹ä¸ªæ•°
    int nodeNumFromSrc;

    State(int id, int costFromSrc, int nodeNumFromSrc) {
        this.id = id;
        this.costFromSrc = costFromSrc;
        this.nodeNumFromSrc = nodeNumFromSrc;
    }
}

// è¾“å…¥ä¸€ä¸ªèµ·ç‚¹ srcï¼Œè®¡ç®—ä» src åˆ°å…¶ä»–èŠ‚ç‚¹çš„æœ€çŸ­è·ç¦»
int dijkstra(List<int[]>[] graph, int src, int k, int dst) {
    // å®šä¹‰ï¼šä»èµ·ç‚¹ src åˆ°è¾¾èŠ‚ç‚¹ i çš„æœ€çŸ­è·¯å¾„æƒé‡ä¸º distTo[i]
    int[] distTo = new int[graph.length];
    // å®šä¹‰ï¼šä»èµ·ç‚¹ src åˆ°è¾¾èŠ‚ç‚¹ i çš„æœ€å°æƒé‡è·¯å¾„è‡³å°‘è¦ç»è¿‡ nodeNumTo[i] ä¸ªèŠ‚ç‚¹
    int[] nodeNumTo = new int[graph.length];
    Arrays.fill(distTo, Integer.MAX_VALUE);
    Arrays.fill(nodeNumTo, Integer.MAX_VALUE);
    // base case
    distTo[src] = 0;
    nodeNumTo[src] = 0;

    // ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŒcostFromSrc è¾ƒå°çš„æ’åœ¨å‰é¢
    Queue<State> pq = new PriorityQueue<>((a, b) -> {
        return a.costFromSrc - b.costFromSrc;
    });
    // ä»èµ·ç‚¹ src å¼€å§‹è¿›è¡Œ BFS
    pq.offer(new State(src, 0, 0));

    while (!pq.isEmpty()) {
        State curState = pq.poll();
        int curNodeID = curState.id;
        int costFromSrc = curState.costFromSrc;
        int curNodeNumFromSrc = curState.nodeNumFromSrc;
        
        if (curNodeID == dst) {
            // æ‰¾åˆ°æœ€çŸ­è·¯å¾„
            return costFromSrc;
        }
        if (curNodeNumFromSrc == k) {
            // ä¸­è½¬æ¬¡æ•°è€—å°½
            continue;
        }

        // å°† curNode çš„ç›¸é‚»èŠ‚ç‚¹è£…å…¥é˜Ÿåˆ—
        for (int[] neighbor : graph[curNodeID]) {
            int nextNodeID = neighbor[0];
            int costToNextNode = costFromSrc + neighbor[1];
            // ä¸­è½¬æ¬¡æ•°æ¶ˆè€— 1
            int nextNodeNumFromSrc = curNodeNumFromSrc + 1;

            // æ›´æ–° dp table
            if (distTo[nextNodeID] > costToNextNode) {
                distTo[nextNodeID] = costToNextNode;
                nodeNumTo[nextNodeID] = nextNodeNumFromSrc;
            }
            // å‰ªæï¼Œå¦‚æœä¸­è½¬æ¬¡æ•°æ›´å¤šï¼ŒèŠ±è´¹è¿˜æ›´å¤§ï¼Œé‚£å¿…ç„¶ä¸ä¼šæ˜¯æœ€çŸ­è·¯å¾„
            if (costToNextNode > distTo[nextNodeID]
                && nextNodeNumFromSrc > nodeNumTo[nextNodeID]) {
                continue;
            }
            
            pq.offer(new State(nextNodeID, costToNextNode, nextNodeNumFromSrc));
        }
    }
    return -1;
}
```

å…³äºè¿™ä¸ªè§£æ³•è¿™é‡Œå°±ä¸å¤šè§£é‡Šäº†ï¼Œå¯å¯¹ç…§å‰æ–‡ [Dijkstra ç®—æ³•æ¨¡æ¿](https://labuladong.github.io/algo/di-yi-zhan-da78c/shou-ba-sh-03a72/dijkstra-s-6d0b2/) ç†è§£ã€‚